# AI 生成贺卡 · 节约成本方案

## 一、推荐方案（已有 DashScope Key 可直接用）

### 方案 A：通义万相（阿里云，与千问同 Key）

| 项目 | 说明 |
|------|------|
| **费用** | 新用户 **500 张免费**（180 天有效），之后约 **0.08–0.16 元/张** |
| **API Key** | 复用 `DASHSCOPE_API_KEY`（与千问共用） |
| **优点** | 中文效果好、国内直连、无需额外开通 |
| **模型** | `wan2.6-t2i`、`wanx2.0-t2i-turbo`（更快更便宜） |

### 方案 B：LLM 优化提示词 + 按需生成

- 用**千问**根据用户填写内容生成「万相」可用的英文/中文提示词（几乎只花文本 tokens，便宜）
- 用户点击「AI 生成」时才调用万相，避免无意义调用
- 同一用户、同一祝福可缓存 24h，避免重复生成

### 方案 C：预生成 + 文字叠层（成本最低）

- 预先用万相生成 **4–8 张**不同风格的背景图（一次性成本）
- 前端用 Canvas/SVG 把收件人、祝福语叠加到背景上
- **用户使用零调用**，无额外费用

---

## 二、成本对比（按 1000 张/月估算）

| 方案 | 预估成本 |
|------|----------|
| 全部实时万相生成 | 80–160 元/月（扣除免费后） |
| 预生成 8 张 + 文字叠层 | 约 1.3 元（一次性） |
| LLM 提示词 + 按需万相（假设 20% 用户点生成） | 16–32 元/月 |

---

## 三、实施建议

1. **MVP（尽快上线）**：接入通义万相 API，提供「AI 生成」按钮，用户点击才生成
2. **降本**：加缓存（相同 prompt 24h 内复用）、默认展示前端模板，AI 生成作为可选
3. **极致省**：预生成少量精品图 + 文字叠层，作为「AI 风格」模板

---

## 四、通义万相 API 要点

- **端点**：`POST https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation`
- **模型**：`wan2.6-t2i` 或 `wanx2.0-t2i-turbo`
- **尺寸**：`1104*1472`（3:4 竖版海报）
- **提示词**：支持中文，建议控制在 500 字内
- **Key**：复用 `DASHSCOPE_API_KEY`（与千问同一 Key）

## 五、已实现：预生成 + 文字叠层

- **脚本**：`npm run generate-bg` 或 `node scripts/generate-bg-images.mjs`
  - 一次性调用万相生成 4 张背景图，保存到 `public/card-bg/`
  - 需配置 `DASHSCOPE_API_KEY`
- **组件**：`AICardPreview` 使用预生成背景 + 文字叠层，用户端 0 调用
- **导出**：复用 `html2canvas`，导出含文字叠层的完整贺卡
